{% extends 'layout.html' %}

{% block content %}
 
  <!-- CHAT AREA -->
  <div id="chatContainer" class="flex-1 p-4 space-y-4 overflow-y-auto">
    <!-- Chat akan muncul di sini -->
  </div>

  <!-- INPUT -->
  <div class="bg-white border-t border-blue-200 p-4">
    <div class="flex flex-col sm:flex-row gap-2">
      <textarea id="userInput" rows="1" placeholder="Ketik pesan di sini..." class="flex-1 border border-blue-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-300"></textarea>
      <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Kirim</button>
    </div>
  </div>

  <script>
    async function sendMessage() {
      const userInput = document.getElementById("userInput");
      const chatContainer = document.getElementById("chatContainer");

      const message = userInput.value.trim();
      if (!message) return;

      // Tampilkan pesan user
      const userDiv = document.createElement("div");
      userDiv.className = "flex justify-end";
      userDiv.innerHTML = `
        <div class="bg-blue-500 text-white p-3 rounded-2xl max-w-[75%] shadow">
          <p>${message}</p>
        </div>
      `;
      chatContainer.appendChild(userDiv);
      userInput.value = "";
      userInput.style.height = 'auto';
      chatContainer.scrollTop = chatContainer.scrollHeight;

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: message, mode: "Umum" })
        });
        const data = await response.json();

        const botDiv = document.createElement("div");
        botDiv.className = "flex items-start space-x-2";
        botDiv.innerHTML = `
          <img src="../../static/img/sayaka nao 1.png" alt="Chara" class="w-10 h-10 rounded-full object-cover" />
          <div class="bg-blue-200 text-black p-3 rounded-2xl max-w-[75%] shadow">
            <p>${data.reply}</p>
          </div>
        `;
        chatContainer.appendChild(botDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      } catch (error) {
        console.error("Error:", error);
      }
    }
  </script>
{% endblock %}
